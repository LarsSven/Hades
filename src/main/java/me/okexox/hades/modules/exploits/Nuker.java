package me.okexox.hades.modules.exploits;

import me.okexox.hades.Main;
import me.okexox.hades.data.DataList;
import me.okexox.hades.data.PlayerData;
import me.okexox.hades.modules.base.Detection;
import me.okexox.hades.modules.base.FlagType;
import me.okexox.hades.modules.base.interfaces.CheckBlockBreak;
import me.okexox.hades.modules.base.interfaces.DetectionType;
import org.bukkit.Bukkit;
import org.bukkit.entity.Player;
import org.bukkit.event.block.BlockBreakEvent;

public class Nuker extends Detection implements CheckBlockBreak {
    public Nuker() {
        super("Nuker", FlagType.Block, DetectionType.Exploit);
    }

    public void check(BlockBreakEvent e) {
        //TODO: Sensitive to latency
        Player player = e.getPlayer();
        PlayerData data = DataList.getPlayer(player.getName());
        int blocksBroken = data.checkBlocksBroken();
        if(blocksBroken > 10) {
            flag(player, "blocks=" + blocksBroken);
        }
    }

    public static void setTimer(Main main) {
        Bukkit.getServer().getScheduler().scheduleSyncRepeatingTask(main, () -> {
            for(Player player : Bukkit.getOnlinePlayers()) {
                DataList.getPlayer(player.getName()).resetBlocksBroken();
            }
        }, 0L, 20L);
    }
}
